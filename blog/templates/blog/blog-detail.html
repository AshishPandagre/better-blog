<h1>Detail page</h1>
title={{ blog.title }} | author={{ blog.author }} | read time={{ blog.read_time }} <br>
{{ blog.content }}

<br><br><br>
<h2>Comments</h2>

{% if commentForm %}
<form id="comment-form" method="POST" onsubmit="return false;" data-blogid="{{ blog.id }}" >
Write your comment here <br><br>
{{ commentForm.body }}
<button>Send</button>
</form>
<br><br>
{% endif %}

<ul id="commentList">
{% for comment in comments %}
	<li data-commentid="{{ comment.id }}">{{ comment.commenter }} | {{ comment.body }} | likes={{ comment.n_likes }} <button id="delete">Delete</button></li><br>
{% empty %}
	<p>No comments to display</p>
{% endfor %}
</ul>


<script type="text/javascript">
	let commentList = document.getElementById('commentList')
	let deleteBtn = document.getElementById("delete")
	commentList.addEventListener('click', (e)=>{
		if(e.target==deleteBtn){
			console.log("delete this comment.")
		}
	})

	function getCookie(name) {
	let cookieValue = null;
	if (document.cookie && document.cookie !== '') {
		const cookies = document.cookie.split(';');
		for (let i = 0; i < cookies.length; i++) {
			const cookie = cookies[i].trim();
			if (cookie.substring(0, name.length + 1) === (name + '=')) {
				cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
				break;
				}
			}
		}
		return cookieValue;
	}
	const csrftoken = getCookie('csrftoken');

	let commentForm = document.getElementById("comment-form")
	commentForm.addEventListener('submit', () => {
		addComment()
	})

	function showComment(comment){
		commentForm.remove()
		alert('comment added. Auto updated when i learn react. wait until then.')
	}

	function addComment(){
		config = {
			method: "POST",
			body: JSON.stringify({'blogId': commentForm.dataset.blogid, 'comment': commentForm.body.value}),
			headers: {
				'X-CSRFToken': csrftoken,
				'Content-Type': 'application/json',
			}
		}

		fetch('/blog/addComment/', config)
			.then(res => res.json())
			.then(data =>{
				console.log(data)
				if(data.response == "OK"){
					commentForm.remove()
					showComment(data.comment)
				}
			})
	}


</script>
